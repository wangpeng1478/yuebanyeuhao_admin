<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <!-- 是否删除默认的苹果工具栏和菜单栏 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <!-- UC强制全屏 -->
  <meta name="full-screen" content="yes">
  <!-- QQ强制全屏 -->
  <title>悦办越好图片上传</title>
  <meta name="description" content="悦办越好图片上传">
  <meta name="keywords" content="悦办越好图片上传">
  <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/iview/2.13.0/styles/iview.css">
  <script type="text/javascript" src="https://cdn.bootcss.com/vue/2.5.12/vue.min.js"></script>
  <script type="text/javascript" src="https://cdn.bootcss.com/iview/2.13.0/iview.min.js"></script>
  <style>
  .upload{
  	padding: 0.170667rem;
  }
  .Uploadsee{
  	width: 100%;
  }
  .Uploadsee .ivu-upload-select{
  	width: 100%;
  }
  .Uploadsee .ivu-upload-select .ivu-icon{
  	 font-size: 0.341333rem;
  	 color: #2d8cf0;
  }
  .Uploadsee .ivu-upload-select .ivu-upload-drag{
  	 padding: 0.170667rem
  }
  .uploadimg{
  	display: flex;
    align-items: center;
    flex-wrap: wrap;
    border-bottom: 1px solid #dddee1;
    margin-bottom: 10px;
    padding-bottom: 10px;
  }
  .uploadimg a{
  	width: 25%;
  }
  .uploadimg img{
    width: 100%;
    height: auto;
    padding: 0 3%;
  }
  .buttons{
  	font-size: 11px;
    padding: 1.706665rem 0 0.170667rem 0;
    color: #c1c1c1;
    text-align: center;
  }
  .ivu-upload-list .ivu-upload-list-file{
  	margin: 0.170667rem 0;
  }
  .ivu-alert{
  	margin: 0.170667rem 0;
  }
  pre{
  	width: 100%;
  }
  </style>
</head>
<body>
<div id="app">
   <div class="upload">
   <!-- <pre>{{actionUrl}}</pre> -->
   <!-- <pre>{{keys}}</pre> -->
   <!-- <pre>{{img}}</pre> -->
   <!-- <pre>{{dataurls}}</pre> -->
   <Card>
        <p slot="title">
            <Icon type="upload"></Icon>
            上传图片
        </p>
        <div class="uploadimg" v-if="img.length !==0">
         <a :href="n.url" target="_blank" v-for="n in img" :key="n.length">
           <img :src="n.url">
         </a>
        </div>
        <div class="div">
        <Upload class="Uploadsee" 
        multiple
        :headers="keys"
        :action='actionUrl' 
        :before-upload="beforeUpload"
        :on-progress='onProgress'
        :on-success='onSuccess'
        :on-error='onError'
        :on-preview='onPreview'
        :on-remove='onRemove'
        :on-format-error='onFormatError'
        :on-exceeded-size='onExceededSize'
        :format="['jpg','jpeg','png','gif']"
        :max-size="10240">
        <div class="ivu-upload-drag">
            <Icon type="ios-cloud-upload"></Icon>
            <p>点击上传图片</p>
        </div>
	    </Upload>
          <Alert show-icon>上传完毕后点击网页中的 <b>“我已上传完毕”</b> 即可</Alert>
          <p class="buttons">Copyright © 2013-2018 All Rights Reserved. 上海德御房地产经纪事务所版权所有 </p>
        </div>
        <Spin size="large" fix v-if="spinShow"></Spin>
    </Card>

   </div>
</div>
 <script>
 let dataurl = window.location.search
  new Vue({
    el: '#app',
    data: {
      actionUrl: '',
      dataurls: dataurl,
      spinShow: true,
      keys: {},
      img:[]
    },
    mounted(){
    	this.keys = {
            key: 'key',
            name:'admin'
        };
        let data1 = this.dataurls.replace(/\?/, "")
        let data2 = data1.replace(/data=/, "")
        let data3 = data2.split(',')
        if (data3.length ==2) {
        	this.actionUrl = '/api/webup?webid='+data3[0]+'&master='+data3[1]
        	this.spinShow = false;
        }else{
        	this.$Notice.error({
                    title: '错误',
                    desc:'没有获取到URL参数或参数错误',
                    duration: 0
                });
        }
        
    },
    methods: {
       beforeUpload(){
         //参数为上传的文件，若返回 false 或者 Promise 则停止上传
       },
       onProgress(event, file, fileList){
       },
       onSuccess(response, file, fileList){
       	 // ok
          console.log(response.message)
          this.img.push({
            url:'http://47.98.155.165'+response.message
          })
       },
       onError(error, file, fileList){
         console.log(error)
         console.log(file)
         console.log(fileList)
         this.$Notice.warning({
                    title: '文件上传失败',
                    desc: '文件  ' + file.name + ' 文件上传失败'
                });
         
       },
       onPreview(file){
         //可以通过 file.response 拿到服务端返回数据
         // console.log(file)
       },
       onRemove(file, fileList){
       },
       onFormatError(file, fileList){
         this.$Notice.warning({
              title: '文件格式不正确',
              desc: '文件格式 ' + file.name + ' 不正确，[jpg,jpeg,png,gif]'
          });

       },
       onExceededSize(file, fileList){ 
          this.$Notice.warning({
                    title: '超出文件大小限制',
                    desc: '文件  ' + file.name + ' 太大，不超过10M。'
                });
       },
       headerss(){
         // return Authorization:'Bearer '+Cookies.set('keya')
       },
    }
  })

  </script>
  <script>
(function(doc, win) {
    var docEl = doc.documentElement,
        resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
        recalc = function() {
            var clientWidth = docEl.clientWidth;
            if (!clientWidth) return;
            if (clientWidth >= 640) {
                docEl.style.fontSize = '100px';
            } else {
                docEl.style.fontSize = 100 * (clientWidth / 640) + 'px';
            }
        };

    if (!doc.addEventListener) return;
    win.addEventListener(resizeEvt, recalc, false);
    doc.addEventListener('DOMContentLoaded', recalc, false);
})(document, window);
//rem布局

//http://pan.baidu.com/share/qrcode?w=250&h=250&url=http://47.98.155.165/admin/upload.html
  </script>
</body>

</html>
